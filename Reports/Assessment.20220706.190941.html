<!DOCTYPE html>
<html>
<head>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,300' rel='stylesheet' type='text/css'>
  <style>
      /* Global properties */
:root
{
    --sc-grey: #C7C7C7;
    --sc-blue: #2196F3;
    --sc-dark-blue: #0085CD;
    --sc-light-blue: #77c1fd;
    --sc-background-color: #FAFAFA;
    --sc-font-color: #808080;
    --sc-separator-color: #E4E4E4;
    --sc-pink:#FF4081;
    --sc-green: #81C784;
    --sc-orange: #FFB74D;
}

/* Loading div */
.loader {
    border: 8px solid var(--sc-grey);
    border-radius: 50%;
    border-top: 8px solid var(--sc-dark-blue);
    width: 30px;
    height: 30px;
    -webkit-animation: spin 0.5s linear infinite; /* Safari */
    animation: spin 0.5s linear infinite;
    margin-left: 50%;
    margin-top: 400px;
}

/* Safari */
@-webkit-keyframes spin {
    0% {
        -webkit-transform: rotate(0deg);
    }

    100% {
        -webkit-transform: rotate(360deg);
    }
}

@keyframes spin {
    0% {
        transform: rotate(0deg);
    }

    100% {
        transform: rotate(360deg);
    }
}

/* General */

.report
{
    background-color: var(--sc-background-color);
    font-family:'Open Sans';
    color: var(--sc-font-color);
    font-size: 13px;
    line-height: 0.2;    
}

.card
{
    margin: 8px;
    background-color: white;
    border-radius: 5px;
    box-shadow: 1px 2px 4px var(--sc-grey);
}

.card-title
{
    line-height: 1;
    border-bottom: var(--sc-separator-color);
    border-bottom-width: 1px;
    border-bottom-style: solid;
    padding-top: 12px;
    padding-bottom: 12px;
    font-weight: 800;
    text-align: center;
    color: black;
}

.card-content
{    
    display: grid;
    height: 75%;
    margin-top: 15px;
    margin-left: 80px;
    margin-right: 80px; 
}

.card-footer 
{
    margin-top: 30px;
    margin-bottom: 30px;
    text-align: center;
}

.link
{
    cursor: pointer;
    color: var(--sc-dark-blue);
    text-decoration: underline;
    text-decoration-color: var(--sc-dark-blue);
}

h4
{
    font-weight:bolder;
}

#content
{
    height: auto;
    min-width: 1200px;
    max-width: 1200px;
    margin: auto;
    padding-top: 10px;
    padding-bottom: 10px;
}

.rectangle{
    display: grid;
    height: 59px;
    width: 59px;
    border-radius: 4px;
    margin: auto;
}

.summary-item
{
    display: grid;
    grid-template-columns: 100px auto;
    align-content: center;
}

.summary-icons
{
    display: grid;
    margin: auto;
    height: 24px;
    width: 24px;
}

.summary-icons > img
{
    margin: auto;
}

.summary-item-info
{
    display: grid;
}

.button
{
    cursor: pointer;
    color: var(--sc-dark-blue); 
    font-size: 12px;
    font-weight: 650;
    background-color: transparent;
    border-radius: 5px;
    border: var(--sc-dark-blue) 1px solid;
    margin-left: 10px;
    margin-right: 10px;
    margin-top: 30px;
    margin-bottom: 30px;
}

/* Header section */

#header
{
    display: grid;
    grid-template-columns: 75% 25%;    
    height: 100px;
    margin: 8px;
}

#logo > img
{
    float:right;
}

#summary
{
    display: grid;
    grid-template-columns: 25% 25% 25% 25%;    
    height: 120px;
}

#summary > div
{
    text-align: center;
}

#files-rectangle
{
    background-color: var(--sc-dark-blue);
}

#objects-rectangle
{
    background-color: var(--sc-light-blue);
}

#lines-rectangle
{
    background-color: var(--sc-pink);
}

#conversion-rectangle
{
    background-color:var(--sc-green);
}

.summary-item-value
{
    text-align: left;
    font-size: 19px;
    font-weight: 800;
    letter-spacing: 0.15px;
}

.summary-item-name
{
    text-align: left;
    font-size: 13px;
    letter-spacing: 0.15px;
}

/* Automation section */

#automation
{
    display: grid;
    grid-template-columns: 65% 35%;    
    height: 350px;
    text-align: center;
    line-height: 1.25;
}

.steps-grid
{
    display: grid;
    grid-template-columns: 33.33% 33.33% 33.33%;    
}

#steps-content
{
    display: grid;
    grid-template-rows: 60px 60px 90px 40px;
}

#steps-bar
{
    display: grid;
    grid-template-columns: 36px 164px 36px 164px 36px;   
    margin: auto;
}

#steps-description > p
{
    margin-left: 35px;
    margin-right: 35px;
}

.circle
{
    height: 34px;
    width: 34px;
    border-radius: 50%;
    border: var(--sc-green) 2px solid;
    margin: auto;
    font-size: 19px;
    font-weight: 800;
    line-height: 32px;
}

#first-step
{    
    background-color: var(--sc-green);
    color: white;
}

#second-step
{    
    color: var(--sc-green);
}

#third-step
{    
    color: var(--sc-grey);
    border-color: var(--sc-grey);
}

.line
{
    border-top-width: 2px;
    border-top-style: solid;
    margin-top: 17px;
}

#first-line
{
    border-color: var(--sc-green);
}

#second-line
{
    border-color: var(--sc-grey);
}

#saving-content
{
    display: grid;
    grid-template-rows: 50px 80px 80px 40px;
}

#saving-content > div
{
    margin-bottom: 20px;
}

#manual-rectangle
{
    background-color: var(--sc-light-blue);
}

#action-rectangle
{
    background-color: var(--sc-orange);
}

.saving-item
{
    font-weight: 700;
    margin-left: 15px;
    margin-right: 15px;
}

/* Conversion section */

#conversion-chart
{
    height: auto;
}

/* Objects inventory section */

#object-inventory {
    display: grid;
    grid-template-columns: 250px auto;
    margin-right: 130px;
    margin-left: 130px;
    height: 60px;
}

#object-inventory-text {
    text-align: justify;
    margin: auto;
    line-height: 1.5;
    font-size: 12px;
}

#object-inventory-button {
    margin: auto;
    width: 169;
    height: 36px;
}

#object-button-container {
    display: grid;
}


/* Action items section */
#action-items
{
    display: grid;
    grid-template-columns: 65% 35%;    
    height: auto;
    min-height: 350px;
    line-height: 1.3;
}

#top-actions-content
{
    grid-template-rows: 100px 30px auto;
    margin-left: 30px;
    margin-right: 30px;    
}

#top-actions-explanation
{
    display: grid;
    grid-template-columns: 80px auto;    
    margin-bottom: 50px;
}

#explanation-text
{
    margin: auto;
}

.issues-breakdown
{
    display: grid;
    grid-template-columns: 100px auto;
}

.issue-description
{
    margin-left: 60px;
}

.issue-separator
{
    border-bottom: var(--sc-grey) 1px solid;
    margin-bottom: 8px;
}

#action-distribution-content
{
    display: grid;
    grid-template-rows: 180px auto;
    height: 85%;    
    margin-left: 80px;
    margin-right: 80px;     
}

#action-distribution-content > div 
{
   display: grid;   
}

#distribution-chart > canvas
{   
   margin-left: auto;
   margin-right: auto;
   width: 180px !important;
   height: 180px !important;
}

#labels
{
    margin-top: 10px;
    margin-bottom: 10px;
}

.label > div
{
    display: grid;
    grid-template-columns: 20px auto;
    margin-top: 5px;
    margin-bottom: 5px;
}

.bullet-point
{
    margin-top: 2px;
    margin-bottom: auto;
    margin-left: auto;
    margin-right: auto;
    width: 15px;
    height: 15px;
    border-radius: 2px;
}

.label-text
{
    margin-left: 5px;
    margin-bottom: auto;    
    font-size: 10px;
}

.slide-0
{
    background-color: var(--sc-light-blue);
}

.slide-1
{
    background-color: var(--sc-dark-blue);
}

.slide-2
{
    background-color: var(--sc-blue);
}

.slide-3
{
    background-color: var(--sc-grey);
}

#no-items-content
{
    height: 50px;
    text-align: center;
    line-height: 50px;
}

/* Footer section */

#footer
{
    text-align: center;
    line-height: 1.5;
    font-size: 12px;
    margin: 8px;
    height: 50px;    
}
  </style>  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
</head>
<body class="report">
    <div id="app">
        <div class="loader" id="loader"></div>
        <div id="content" hidden>
            <!-- Header section -->
            <div id="header">
                <div id="general-info">
                    <h4>Conversion Report</h4>
                    </br>
                    <p>Run ID: {{migrationData.HeaderSection.Items[2].ItemValue}}</p>
                    <p>{{migrationData.HeaderSection.Items[3].ItemValue}}</p>
                    <p>SnowConvert version number {{migrationData.HeaderSection.Items[0].ItemValue}}</p>
                </div>
                <div id="logo">
                    <img width="190" src="https://mobilizeproduct.blob.core.windows.net/snow/SnowContent/htmlreport/img/logo.svg">
                </div>
            </div>
            <!-- Summary section of main conversion information  -->
            <div id="summary">
                <div id="files" class="card summary-item">
                    <div class="rectangle" id="files-rectangle">
                        <div id="files-icon" class="summary-icons">
                            <img width="16" height="20" src="https://mobilizeproduct.blob.core.windows.net/snow/SnowContent/htmlreport/img/files.svg">
                        </div>
                    </div>
                    <div class="summary-item-info">
                        <p class="summary-item-value">{{migrationData.SummarySection.Items[0].ItemValue}}</p>
                        <p class="summary-item-name">{{migrationData.SummarySection.Items[0].ItemName}}</p>
                    </div>
                </div>
                <div id="objects" class="card summary-item">
                    <div class="rectangle" id="objects-rectangle">
                        <div id="objects-icon" class="summary-icons">
                            <img width="18.5" height="15" src="https://mobilizeproduct.blob.core.windows.net/snow/SnowContent/htmlreport/img/objects.svg">
                        </div>
                    </div>
                    <div class="summary-item-info">
                        <p class="summary-item-value">{{migrationData.SummarySection.Items[1].ItemValue}}</p>
                        <p class="summary-item-name">{{migrationData.SummarySection.Items[1].ItemName}}</p>
                    </div>
                </div>
                <div id="lines" class="card summary-item">
                    <div class="rectangle" id="lines-rectangle">
                        <div id="lines-icon" class="summary-icons">
                            <img width="19.17" height="11.19" src="https://mobilizeproduct.blob.core.windows.net/snow/SnowContent/htmlreport/img/code.svg">
                        </div>
                    </div>
                    <div class="summary-item-info">
                        <p class="summary-item-value">{{migrationData.SummarySection.Items[2].ItemValue}}</p>
                        <p class="summary-item-name">{{migrationData.SummarySection.Items[2].ItemName}}</p>
                    </div>
                </div>
                <div id="conversion" class="card summary-item">
                    <div class="rectangle" id="conversion-rectangle">
                        <div id="conversion-icon" class="summary-icons">
                            <img width="20" height="16" src="https://mobilizeproduct.blob.core.windows.net/snow/SnowContent/htmlreport/img/conversion.svg">
                        </div>
                    </div>
                    <div class="summary-item-info">
                        <p class="summary-item-value">{{migrationData.SummarySection.Items[3].ItemValue}}%</p>
                        <p class="summary-item-name">{{migrationData.SummarySection.Items[3].ItemName}}</p>
                    </div>
                </div>
            </div>

            <!-- Automation section for the next steps and estimated savings -->
            <div id="automation">
                <div id="steps" class="card">
                    <div class="card-title">Next Steps</div>
                    <div id="steps-content" class="card-content">
                        <div id="steps-bar">
                            <div id="first-step" class="circle">✓</div>
                            <div id="first-line" class="line"></div>
                            <div id="second-step" class="circle">2</div>
                            <div id="second-line" class="line"></div>
                            <div id="third-step" class="circle">3</div>
                        </div>
                        <div id="steps-description" class="steps-grid">
                            <p>Run the assessment</p>
                            <p>Review your migration strategy</p>
                            <p>Migrate successfully to Snowflake</p>
                        </div>
                        <div class="steps-grid">
                            <button type="button" class="button" v-on:click="openLink()">TALK TO ENGINEER</button>
                            <button type="button" class="button" v-on:click="openLink()">PRICING INFORMATION</button>
                            <button type="button" class="button" v-on:click="openLink()">PLAN YOUR MIGRATION</button>
                        </div>
                        <div class="link card-footer" v-on:click="openLink()">
                            Partnership with Mobilize.Net
                        </div>
                    </div>
                </div>
                <div id="saving" class="card">
                    <div class="card-title">Estimated Savings and Action Items</div>
                    <div id="saving-content" class="card-content">
                        <div>
                            Using Mobilize.Net SnowConvert to automate your migration you could:
                        </div>
                        <div class="summary-item">
                            <div class="rectangle" id="manual-rectangle">
                                <div id="time-icon" class="summary-icons">
                                    <img width="20" height="20" src="https://mobilizeproduct.blob.core.windows.net/snow/SnowContent/htmlreport/img/time.svg">
                                </div>
                            </div>
                            <div class="summary-item-info">
                                <p class="saving-item">{{migrationData.AutomationSection.Items[0].Message.replace("@", migrationData.AutomationSection.Items[0].EstimatedHours)}}</p>
                            </div>
                        </div>
                        <div class="summary-item">
                            <div class="rectangle" id="action-rectangle">
                                <div id="time-icon" class="summary-icons">
                                    <img width="20" height="20" src="https://mobilizeproduct.blob.core.windows.net/snow/SnowContent/htmlreport/img/time.svg">
                                </div>
                            </div>
                            <div class="summary-item-info">
                                <p class="saving-item">{{migrationData.AutomationSection.Items[1].Message.replace("@", migrationData.AutomationSection.Items[1].EstimatedHours)}}</p>
                            </div>
                        </div>
                        <div class="link card-footer" v-on:click="openLink()">
                            How is it calculated?
                        </div>
                    </div>
                </div>
            </div>

            <!-- Conversion of top level objects section -->
            <div id="conversion-chart" class="card">
                <div class="card-title">Code Conversion Rate</div>
                <div class="card-content" id="conversion-chart">
                    <div v-if="FillConversionInventories()">
                        <top-level-conversion-chart></top-level-conversion-chart>
                        <div class="card-footer">
                            Action items: Pieces of code that might require manual work or inspection after running SnowConvert.
                        </div>
                    </div>
                    <div v-else class="card-footer">
                        No objects found
                    </div>
                </div>
            </div>

            <!-- Object inventory link -->
            <div id="object-inventory">
                <div id="object-button-container">
                    <button id="object-inventory-button" type="button" class="object-inventory-button button" v-on:click="openDirectory()">OBJECT INVENTORY</button>
                </div>
                <div id="object-inventory-text">
                    <span>
                        Review each content that was identified and marked for conversion in your source code here. Note that this is a csv file that will download. For more information about how to interpret this csv file, visit our
                    </span>
                    <span class="link" v-on:click="openLink(links.topLevelDocumentation)">documentation web site.</span>
                </div>
            </div>

            <!-- Action items section -->
            <div id="action-items" v-if="FillTopActionItemDistributionInventories()">
                <div id="top-actions" class="card">
                    <div class="card-title">Top Action Items</div>
                    <div id="top-actions-content" class="card-content">
                        <div id="top-actions-explanation">
                            <div class="rectangle" id="action-rectangle">
                                <div id="time-icon" class="summary-icons">
                                    <img width="20" height="20" src="https://mobilizeproduct.blob.core.windows.net/snow/SnowContent/htmlreport/img/objects.svg">
                                </div>
                            </div>
                            <div id="explanation-text">
                                The top {{migrationData.ActionItemSection.ItemsCount}} action items account for <strong>{{migrationData.ActionItemSection.TopItemsDistribution}}%</strong> of the total action items. Resolving these {{migrationData.ActionItemSection.ItemsCount}} unique issues may significantly reduce the amount of time remaining to complete a migration. These can be resolved manually or in
                                <span class="link" v-on:click="openLink()">partnership with Mobilize.Net</span>
                            </div>
                        </div>
                        <div class="issues-breakdown">
                            <div><strong>ACTION ITEMS</strong></div>
                            <div class="issue-description"><strong>DESCRIPTION</strong></div>
                        </div>
                        <div class="issues-breakdown"
                             v-for="(item, index) in migrationData.ActionItemSection.Items"
                             v-bind:class="[index < (migrationData.ActionItemSection.ItemsCount - 1) ? 'issue-separator' : '']"
                             v-if="index < migrationData.ActionItemSection.ItemsCount">
                            <div class="link" v-on:click="openLink(migrationData.ActionItemSection.Items[index].DocumentationUrl)">{{index + 1}}. {{migrationData.ActionItemSection.Items[index].Name}}</div>
                            <div class="issue-description">{{migrationData.ActionItemSection.Items[index].Recommendation}}</div>
                        </div>
                    </div>
                </div>
                <div id="actions-distribution" class="card">
                    <div class="card-title">Top Action Items Distribution</div>
                    <div id="action-distribution-content">
                        <div>
                            <action-items-distribution-chart id="distribution-chart"></action-items-distribution-chart>
                        </div>
                        <div id="labels">
                            <div class="label" v-for="(item, index) in migrationData.ActionItemSection.Items">
                                <div v-if="migrationData.ActionItemSection.Items[index].DistributionPercentage > 0">
                                    <div v-bind:class="[index == migrationData.ActionItemSection.ItemsCount? 'slide-3' : 'slide-' + index]" class="bullet-point"></div>
                                    <div class="label-text">
                                        {{migrationData.ActionItemSection.Items[index].Recommendation}}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div v-else>
                <div id="top-actions" class="card">
                    <div class="card-title">Top Action Items</div>
                    <div id="no-items-content" class="card-content">
                        No action items requires manual work or inspection after running SnowConvert.
                    </div>
                </div>
            </div>

            <!-- Footer containing support contact -->
            <div id="footer">
                <div>
                    For a complete review of your action items, contact us at
                    <span class="link" v-on:click="openLink(links.support)">support@mobilize.net</span>.
                </div>
                <div>
                    You can also post a message to our
                    <span class="link" v-on:click="openLink(links.forum)">forums</span> if you have a question about a specific item.
                </div>
                <div>
                    <span class="link" v-on:click="openLink(links.guide)">How to read this report?</span>
                </div>
            </div>
        </div>
    </div>
    <script src="https://mobilizeproduct.blob.core.windows.net/snow/SnowContent/htmlreport/src/vue.js"></script>
    <script src="https://mobilizeproduct.blob.core.windows.net/snow/SnowContent/htmlreport/src/vuetify.js"></script>
    <script src="https://mobilizeproduct.blob.core.windows.net/snow/SnowContent/htmlreport/src/chart.js"></script>
    <script src="https://mobilizeproduct.blob.core.windows.net/snow/SnowContent/htmlreport/src/chartjs-plugin-datalabels.min.js"></script>
    <script src="https://mobilizeproduct.blob.core.windows.net/snow/SnowContent/htmlreport/src/vue-chartjs.min.js"></script>
    <script type="text/javascript">
        // HTML report data
var json = {"SourceLanguage":"Teradata","HeaderSection":{"Items":[{"ItemName":"CoreVersion","ItemValue":"7.2.6-rc0005"},{"ItemName":"AppVersion","ItemValue":"Not Provided"},{"ItemName":"RunId","ItemValue":"20220706.190941"},{"ItemName":"Date","ItemValue":"2022/07/06"}]},"SummarySection":{"Items":[{"ItemName":"Files","ItemValue":"1"},{"ItemName":"Identified Objects","ItemValue":"4"},{"ItemName":"Lines Of Code","ItemValue":"41"},{"ItemName":"Conversion Rate","ItemValue":"95"}]},"AutomationSection":{"Items":[{"Message":"Save @ manual migration hours","EstimatedHours":""},{"Message":"Invest @ time in the pending items","EstimatedHours":""}]},"ConversionSection":{"Items":[{"ObjectName":"Table","IdentifiedCount":1,"SuccessConversionPercentage":100.0,"FullyConvertedObjects":0,"PartiallyConvertedPercentage":0.0,"PartiallyConvertedObjects":0},{"ObjectName":"View","IdentifiedCount":1,"SuccessConversionPercentage":100.0,"FullyConvertedObjects":0,"PartiallyConvertedPercentage":0.0,"PartiallyConvertedObjects":0},{"ObjectName":"Join Index","IdentifiedCount":0,"SuccessConversionPercentage":0.0,"FullyConvertedObjects":0,"PartiallyConvertedPercentage":0.0,"PartiallyConvertedObjects":0},{"ObjectName":"Macro","IdentifiedCount":0,"SuccessConversionPercentage":0.0,"FullyConvertedObjects":0,"PartiallyConvertedPercentage":0.0,"PartiallyConvertedObjects":0},{"ObjectName":"Procedure","IdentifiedCount":2,"SuccessConversionPercentage":100.0,"FullyConvertedObjects":0,"PartiallyConvertedPercentage":0.0,"PartiallyConvertedObjects":0},{"ObjectName":"Function","IdentifiedCount":0,"SuccessConversionPercentage":0.0,"FullyConvertedObjects":0,"PartiallyConvertedPercentage":0.0,"PartiallyConvertedObjects":0},{"ObjectName":"Bteq","IdentifiedCount":0,"SuccessConversionPercentage":0.0,"FullyConvertedObjects":0,"PartiallyConvertedPercentage":0.0,"PartiallyConvertedObjects":0},{"ObjectName":"FastLoad","IdentifiedCount":0,"SuccessConversionPercentage":0.0,"FullyConvertedObjects":0,"PartiallyConvertedPercentage":0.0,"PartiallyConvertedObjects":0},{"ObjectName":"MultiLoad","IdentifiedCount":0,"SuccessConversionPercentage":0.0,"FullyConvertedObjects":0,"PartiallyConvertedPercentage":0.0,"PartiallyConvertedObjects":0},{"ObjectName":"TPT","IdentifiedCount":0,"SuccessConversionPercentage":0.0,"FullyConvertedObjects":0,"PartiallyConvertedPercentage":0.0,"PartiallyConvertedObjects":0},{"ObjectName":"TPump","IdentifiedCount":0,"SuccessConversionPercentage":0.0,"FullyConvertedObjects":0,"PartiallyConvertedPercentage":0.0,"PartiallyConvertedObjects":0}]},"ActionItemSection":{"Items":[],"ItemsCount":0,"TopItemsDistribution":0}};

// Links dictionary
var links = 
{
    default: 'https://www.mobilize.net/services/database-migrations/snowflake/get-info',
    guide: 'https://docs.mobilize.net/snowconvert/general/reports/html-report',
    forum: 'https://forums.mobilize.net/forum/23-snowconvert/',
    support: 'mailto:support@mobilize.net',
    topLevelDocumentation: 'https://docs.mobilize.net/snowconvert/general/reports/top-level-objects-report'
};

// Register chart data labels plugin to all charts
Chart.register(ChartDataLabels);

/* CONVERSION CHART*/

// Conversion Chart inventories
var conversionChartLabels = [];
var conversionChartSuccessConvertedPercentages = [];
var conversionChartPartiallyConvertedPercentages = [];
var showConversionChart;

// Uses the JSON to fill the conversion inventories
function FillConversionInventories() {
    for (var i = 0; i < json.ConversionSection.Items.length; i++) {
        if (objectWithOccurrences = json.ConversionSection.Items[i].IdentifiedCount > 0) {
            conversionChartLabels.push(json.ConversionSection.Items[i].ObjectName);
            conversionChartSuccessConvertedPercentages.push(json.ConversionSection.Items[i].SuccessConversionPercentage);
            conversionChartPartiallyConvertedPercentages.push(json.ConversionSection.Items[i].PartiallyConvertedPercentage);
        }
    }

    return conversionChartLabels.length > 0;
}

// Dynamically sets the height size of the conversion chart
function SetConversionChartSize() {
    conversionChartBarHeight = 90;
    conversionChartSize = conversionChartLabels.length * conversionChartBarHeight;
    document.querySelector("#conversion-chart canvas").style = "height: " + conversionChartSize + "px";
}

// Formats the datalabels for the conversion chart
function CustomFormatter(value, context) {
    var value = context.dataset.data[context.dataIndex];
    return value != 0 ? value + "%" : "";
}

// Data Labels style
labels = {
   title: {
      font: {
        size: 12,
        family: 'Open Sans'
      }
   },
}

// Datalabels configuration for the conversion chart
dataLabelConfig =
{
    formatter: CustomFormatter,
    align: 'top',
    color: '#808080',
    labels: labels
}

// Definition of the Vue component containing the conversion chart
Vue.component('top-level-conversion-chart', {
    extends: VueChartJs.Bar,
    data: function () {
        return {         
            datacollection: {
                labels: conversionChartLabels,
                datasets: [
                    {
                        label: 'Successfully Converted',
                        backgroundColor: '#9FDA7F',
                        data: conversionChartSuccessConvertedPercentages,
                        datalabels: dataLabelConfig
                    },
                    {
                        label: 'Percentage with Action Items',
                        backgroundColor: '#FFB74D',
                        data: conversionChartPartiallyConvertedPercentages,
                        datalabels: dataLabelConfig
                    }
                ]
            },
            options: {
                barThickness: 22,
                responsive: true,
                maintainAspectRatio: false,
                indexAxis: 'y',
                scales: {
                    x: {
                        stacked: true,
                        grid:
                        {
                            display: false
                        },
                        ticks: {
                            display: false
                        }
                    },
                    y: {
                        stacked: true,
                        grid:
                        {
                            display: false
                        }
                    }
                }               
            }
        }
    },
    mounted() {
        this.renderChart(this.datacollection, this.options)
    }
});

/* TOP ACTION ITEMS DISTRIBUTION CHART */

// Top action items distribution Chart inventories
var actionItemsData = [];
var distributionColors = [ '#77c1fd', '#0085CD', '#2196F3', '#C7C7C7' ];

// Uses the JSON to fill the top action items distribution inventories
function FillTopActionItemDistributionInventories() {
   for(let i = 0; i < json.ActionItemSection.Items.length; i++)
   {
      if(json.ActionItemSection.Items[i].DistributionPercentage > 0)
      {
         actionItemsData[i] = json.ActionItemSection.Items[i].DistributionPercentage;
      }
   }

   // Sets last item of the chart the grey color
   distributionColors[json.ActionItemSection.ItemsCount] = distributionColors[distributionColors.length -1];
   
   return actionItemsData.length > 0;
}

// Dynamically changes font size based on the size of the EWI name
function SetupActionItemsLabelFontSize()
{
   var maxLabelSize = this.MaxElementSize(json.ActionItemSection.Items);
   var fontSize = this.GetSizeBasedOnLabelLength(maxLabelSize);   
   this.ChangeLabelsFontSize(fontSize);   
}

// Gets the max size of the elements of an array
function MaxElementSize(stringArray)
{
   var maxElementLength = 0;
   
   for(i = 0; i < stringArray.length; i++)
   {
      var ewiLength = stringArray[i].Recommendation.length;
      if (ewiLength > maxElementLength ) maxElementLength =  ewiLength;      
   }

   return maxElementLength;
}

// Gets the new font size based on the largest EWI length 
function GetSizeBasedOnLabelLength(largestEWILength)
{
   // Precalculated font ranges
   var labelFontRanges = [{ length: 14, size: 14}, {length: 51, size: 13}, {length: 88, size: 12}];
   var fontSize = 11;

   for(i = 0; i < labelFontRanges.length; i++)
   {
      if(largestEWILength <= labelFontRanges[i]["length"])
      {
         fontSize = labelFontRanges[i]["size"];
         break;
      }
   }

   return fontSize; 
}

// Changes the font size of the labels in the top action distribution section
function ChangeLabelsFontSize(newFontSize)
{
   var labelObjects = document.getElementsByClassName('label-text');
   for(i = 0; i < labelObjects.length; i++) {
      labelObjects[i].style.fontSize = newFontSize + "px";
   }
}

// Definition of the Vue component containing the top action items distribution chart
Vue.component('action-items-distribution-chart', {
	extends: VueChartJs.Pie,
	data: function () {
		return {
			datacollection: {
				datasets: [
					{
						backgroundColor: distributionColors,
						data: actionItemsData,
                  datalabels:
                  {
                     formatter: CustomFormatter,
                     anchor: 'end',
                     align: 'end',
                     color: '#808080',
                     labels: labels
                  }
					},
				],
			},
			options: {
				responsive: true,
            maintainAspectRatio: true,
            radius: 60,            
            animation: 
            {
               duration: 0
            },
            plugins:
            {
               legend: {
                  display: false                  
               }
            }
  	      },
		}
	},
	mounted () {
		this.renderChart(this.datacollection, this.options)
	}
});

// Vue application
var app = new Vue({
   el: '#app',
   vuetify: new Vuetify(),
   data: {
       migrationData: json,
       links: links
   },
   methods: {
       openLink: function (link = links.default) {
            window.open(link);         
       },
       openDirectory: function ()
       {
            var location = window.location.pathname;
            var directory = location.substring(0, location.lastIndexOf('/'));
            this.openLink(directory);
       },
       FillConversionInventories: FillConversionInventories,
       FillTopActionItemDistributionInventories: FillTopActionItemDistributionInventories
   },
   mounted() 
   {
       document.getElementById("content").hidden = false;
       document.getElementById("loader").hidden = true;
       SetConversionChartSize();
       SetupActionItemsLabelFontSize();
   }
});


    </script>
</body>
</html>